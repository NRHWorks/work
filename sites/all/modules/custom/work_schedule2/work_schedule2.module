<?php

function work_schedule2_menu() {

	$items['schedule/day'] = array(
    'title' => 'Schedule - Day',
    'page callback' => 'work_schedule2_day',
    'access callback' => TRUE,
  );
return $items;
}

function work_schedule2_day() {
  $clients = array();
  $tasks = array();  

  $start = date('Y-m-d 00:00:00');
  $end = date('Y-m-d 23:59:59');

  return theme('schedule_day', array('tasks' => work_schedule2_tasks($start, $end)));
}

function work_schedule2_tasks($start, $end) {
	$query = db_select('node', 'n');
	//$query->addField('s', 'field_schedule_value');
	//$query->addField('s', 'entity_id');
	//$query->addField('st', 'entity_id');
	$query->addField('st', 'field_schedule_time_value');
	//$query->addField('fd', 'entity_id');
	$query->addField('fd', 'field_date_value');
	//$query->addField('fu', 'entity_id');
	//$query->addField('fu', 'field_user_uid');
	//$query->addField('u', 'uid');
	$query->addField('u', 'name');
	$query->addField('n', 'title');
	$query->join('field_data_field_schedule', 's', 'n.nid = s.entity_id');
	$query->join('field_data_field_schedule_time', 'st', 'st.entity_id = s.field_schedule_value');
	$query->join('field_data_field_date', 'fd', 'fd.entity_id = st.entity_id');
	$query->join('field_data_field_user', 'fu', 'fu.entity_id = st.entity_id');
	$query->join('users', 'u', 'u.uid = fu.field_user_uid');
	$query->condition('n.type', 'task', '=');
	$query->condition('n.status', '1', '=');
	$data = $query->execute();
	var_dump($data); exit;
	return $data;
}
